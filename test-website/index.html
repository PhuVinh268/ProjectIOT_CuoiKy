<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IOT</title>
    <link rel="icon" href="./assets/img/IOT.jpg" type=""/>
    <link rel="stylesheet" href="assets/css/style.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/paho-mqtt/1.0.1/mqttws31.js" type="text/javascript"></script>
</head>
<body>
    <div id="main">
        <div id="header">
<!-- Begin: Nav -->
            <ul id="nav">
                <li><a href="#">Home</a></li>
                <li><a href="#gioithieu">Giới thiệu chung</a></li>
                <li><a href="#linhkien">Linh kiện chính</a></li>
                <li><a href="#dieukhien">Điều khiển</a></li>
                <li>
                    <a href="#"> 
                        Liên hệ
                     </a>
                    <ul class="subnav">
                        <li><a href="https://www.facebook.com/pv.1404/">FB: Phú Vinh</a></li>
                        <li><a href="https://www.facebook.com/PhamLeQuangHien">FB: Quang Hiển</a></li>
                    </ul>
                </li>
            </ul>
<!-- End: Nav -->  
        </div>

<!--  -->
        <div id="slider">
            <div class="text-content">
                <h2 class="text-heading">IOT</h2>
                <div class="text-description" style="height: 540px;">Internet Of Things</div>
            </div>
        </div>
<!--  -->
        <div id="content">
<!-- About section -->
            <div id="gioithieu" class="content-section">
                <h2 class="section-heading">INTERNET OF THINGS</h2>
                <p class="section-sub-heading">NHÓM 6</p>
                <p class="about-text">
                    <b>Internet of Things là gì?</b>  <br>
Internet of Things, hay IoT, internet vạn vật là đề cập đến hàng tỷ thiết bị vật lý trên khắp thế giới hiện được kết nối với internet, thu thập và chia sẻ dữ liệu. Nhờ bộ xử lý giá rẻ và mạng không dây, có thể biến mọi thứ, từ viên thuốc sang máy bay, thành một phần của IoT. Điều này bổ sung sự “thông minh kỹ thuật số” cho các thiết bị, cho phép chúng giao tiếp mà không cần có con người tham gia và hợp nhất thế giới kỹ thuật số và vật lý.
                </p>
                <div class="list">
                    <div class="item">
                        <p class="name" style="float: left;"> <b><u>Mô hình kết nối IOT</u></b> </p> 
                        <img src="./assets/img/mohinhiot.png" alt="" class="mohinh-img">
                    </div>
                    <div class="clear"></div>
                </div>
            </div>

<!-- Tour section -->
            <div id="linhkien" class="component-section">
                <div class="content-section">
                    <h2 class="section-heading text-white">List of used components</h2>
                    <p class="section-sub-heading text-white">Danh sách linh kiện sử dụng</p>               

<!-- Place -->
                    <div class="places-list">
                        <div class="place-item">
                            <img src="./assets/img/places/esp8266.jpg" alt="ESP8266" class="place-img">
                            <div class="place-body" style="padding-bottom: 18px;">
                                <h3 class="place-heading">ESP8266</h3>
                                <p class="place-name">KIT thu phát Wifi</p>
                                <br>
                                <p class="place-description">Được dùng cho các ứng dụng cần kết nối, thu thập dữ liệu và điều khiển qua sóng Wifi, đặc biệt là các ứng dụng liên quan đến IoT</p>   
                                <br>                            
                                <a href="https://hshop.vn/products/kit-rf-thu-phat-wifi-esp8266-nodemcu" class="place-buy-btn" style="margin-top: 39px;">Chi tiết sản phẩm</a>
                            </div>
                        </div>
<!--  -->
                        <div class="place-item">
                            <img src="./assets/img/places/mg90s.png" alt="MG90S" class="place-img">
                            <div class="place-body" style="padding-bottom: 18px;">
                                <h3 class="place-heading">MG90S</h3>
                                <p class="place-name">Động cơ RC Servo MG90S</p>
                                <p class="place-description">Là phiên bản nâng cấp của động cơ RC Servo 9G với các bánh răng được làm bằng kim loại cho lực kéo mạnh và độ chính xác cao hơn các loại làm bằng nhựa</p>                               
                                <a href="https://hshop.vn/products/dong-co-rc-servo-mg90s" class="place-buy-btn" style="margin-top: 35px;">Chi tiết sản phẩm</a>
                            </div>
                        </div>
<!--  -->
                        <div class="place-item">
                            <img src="./assets/img/places/ds18b20.jpg" alt="" class="place-img">
                            <div class="place-body" style="padding-bottom: 18px; margin-top: -21px;">
                                <h3 class="place-heading" style="padding-top: 85px;">DS18B20</h3>
                                <p class="place-name">Cảm biến nhiệt độ</p>
                                <p class="place-description">DS18b20 là IC cảm biến nhiệt độ, chỉ bao gồm 3 chân, đóng gói dạng TO-92 3 chân nhỏ gọn.
                                    Với kích thước cực kì nhỏ gọn và khả năng tương tự như các cảm biến nhiệt độ khác.</p>                                
                                <a href="https://hshop.vn/products/cam-bien-nhiet-do-ds18b20-ic" class="place-buy-btn" style="margin-top: 30px;">Chi tiết sản phẩm</a>
                            </div>
                        </div>
<!--  -->

                        <div class="place-item">
                            <img src="./assets/img/places/mq2.jpg" alt="New York" class="place-img">
                            <div class="place-body" style="padding-bottom: 18px;">
                                <h3 class="place-heading">MQ-2</h3>
                                <p class="place-name">Cảm biến khí gas</p>
                                <p class="place-description">MQ2 hoạt động rất tốt trong môi trường khí hóa lỏng LPG, H2, và các chất khí gây cháy khác. Nó được sử dụng rộng rãi trong công nghiệp và dân dụng do mạch đơn giản và chi phí thấp.</p>
                                <a href="https://hshop.vn/products/cam-bien-khi-gas-lpg-co-ch4-mq-2" class="place-buy-btn" style="margin-top: 31px;">Chi tiết sản phẩm</a>
                            </div>
                        </div>
                        <div class="clear"></div>
                    </div>
                </div>
            </div>

<!-- Điều khiển -->
            <div id="dieukhien" class="content-section">
                <h2 class="section-heading">DEVICE CONTROLS</h2>
                <p class="section-sub-heading">Điều khiển các thiết bị</p>               
                
                <div id="control">

                    <!-- SET UP -->
                    <div id="khung1-1">
                
                      <div id="khung1-2">  
                         <h1 class="h1">Điều khiển LED</h1> 
                         <div style="margin-top: 10px;"> Trạng thái LED trên device 1: <b><pan id="LED1"><pan></b> </div>
                            <div>
                                <button class="bt_on" onclick="on('DV1')">ON</button>
                                <button class="bt_off" onclick="off('DV1')">OFF</button>
                            </div>
                   
                         <div>Trạng thái LED trên device 2: <b><pan id="LED2"><pan></b></div>
                            <div>
                                <button class="bt_on" onclick="on('DV2')">ON</button>
                                <button class="bt_off" onclick="off('DV2')">OFF</button>
                            </div>
                   
                   
                         <div>Địa chỉ IP: </div>
                         <div><input id="pass" type="text" value="" placeholder="IPConfig" style="margin-top: 8px" /></div>
                       
                         <div>
                           <button id="connect" onclick="MQTTconnect()">CONNECT</button>
                         </div>
        
                      </div>
                    </div>
                      
<!-- Device -->
                <div id="khung2-1">
                    <div id="khung2-2">
                            <div id="device">       
                                <div id="ds18b20">
                                    <h1 class="h1">DS18B20</h1>
                                    <label for="temp">Nhiệt độ</label>
                                    <input type="text" id="temp" style="margin-top: 10px;">
                                </div>
                
                                <div id="mq2">
                                    <h1 class="h1">MQ-2</h1>
                                    <label for="temp">Khí Gas</label>
                                    <input type="text" id="MQ2" style="margin-top: 10px;">
                                </div>
                
                                <div id="mg90s">
                                  <h1 class="h1">MG90S</h1>
                                  <div>Trạng thái ON/OFF: <b><pan id="servo"><pan></b></div>
                                    <div>
                                     <button class="bt_on" onclick="onServo()">ON</button>
                                     <button class="bt_off" onclick="offServo()">OFF</button>
                                   </div>
                                </div>
                            </div>  
                    </div>
                </div>
                </div>

            </div>            
<!-- End: Contact section -->
            <div class="end">
                <img src="./assets/img/end/tks.gif" alt="">     
            </div>
        </div>


<!--  -->
<script type="text/javascript" language="javascript">
    var mqtt;
		var reconnectTimeout = 2000;
		//var host="82.165.158.236";
		//var host="steve-laptop"; //change this
		//var host="localhost";
		var port=8883
		//var port=9001;
		//var port=8881;
		function onMessageArrived(msg) {
		    //out_msg = "Message received " + msg.payloadString + "<br>";
		    //out_msg = out_msg + "Message received Topic " + msg.destinationName;
		    //console.log(out_msg);
		    //alert(msg);
		    var obj = JSON.parse(msg.payloadString);
            
		    if(obj.ID == "DV1")
        {
          temp.value = obj.temp;
        }
        else if(obj.ID == "DV2")
        {
          MQ2.value = obj.MQ2+" %";
        }
		}
	 	function onConnect() {
	  // Once a connection has been made, make a subscription and send a message.

		console.log("Connected ");
		mqtt.subscribe("common");
		message = new Paho.MQTT.Message("Hello World");
		message.destinationName = "sensor5";
		mqtt.send(message);
    alert("đã kết nối");
	  }
	  function MQTTconnect() {
		console.log("connecting to "+ pass.value +" "+ port);
			var x=Math.floor(Math.random() * 10000);
		var cname="orderform-"+x;
		mqtt = new Paho.MQTT.Client(pass.value, port, cname);
		mqtt.onMessageArrived = onMessageArrived
		//document.write("connecting to "+ host);
		var options = {

			timeout: 3,
			onSuccess: onConnect,
			userName : "vinhhien",
			password : "123"
      
		 };

		mqtt.connect(options); //connect
		}
	  function on(dev) {
        if(dev == "DV1")
        {
          LED1.innerHTML = "ON";
        }
        else
        {
          LED2.innerHTML = "ON";
        }
	      message = new Paho.MQTT.Message('{"IDGW":"GW","contac":"on","ID":"'+dev+'"}');
	      message.destinationName = "GW";
	      mqtt.send(message);
	  }
	  function off(dev) {
        if(dev == "DV1")
        {
          LED1.innerHTML = "OFF";
        }
        else
        {
          LED2.innerHTML = "OFF";
        }
	      message = new Paho.MQTT.Message('{"IDGW":"GW","contac":"off","ID":"'+dev+'"}');
	      //alert('{"IDGW":"GW","contac":"off","ID":"DV1"}');
	      message.destinationName = "GW";
	      mqtt.send(message);
	  }
    function onServo()
    {
        servo.innerHTML = "ON";
        message = new Paho.MQTT.Message('{"IDGW":"GW","servo":"on","ID":"DV1"}');
	      //alert('{"IDGW":"GW","contac":"off","ID":"DV1"}');
	      message.destinationName = "GW";
	      mqtt.send(message);
    }
    function offServo()
    {
        servo.innerHTML = "OFF";
        message = new Paho.MQTT.Message('{"IDGW":"GW","servo":"off","ID":"DV1"}');
	      //alert('{"IDGW":"GW","contac":"off","ID":"DV1"}');
	      message.destinationName = "GW";
	      mqtt.send(message);
    }
      </script>
    </div>
</body>
</html>